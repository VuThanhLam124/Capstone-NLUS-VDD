# QUY TẮC NGHIỆP VỤ TPC-DS

=== QUY TẮC SQL CƠ BẢN ===
1. KHÔNG thêm filter (WHERE) nếu câu hỏi KHÔNG yêu cầu
2. KHÔNG bịa cột/bảng không có trong schema
3. Luôn dùng alias cho bảng
4. Output ONLY the SQL query, no explanation.

=== DOANH THU & SỐ LƯỢNG ===
- "doanh thu"/"tổng tiền" → SUM(net_paid) [KHÔNG phải sales_price!]
- "bán chạy nhất"/"bán nhiều nhất" → SUM(quantity)

=== KÊNH BÁN HÀNG ===
MẶC ĐỊNH = store_sales (ss) khi không nói rõ kênh

- "cửa hàng/store" → store_sales
- "online/web" → web_sales  
- "catalog" → catalog_sales
- "tỷ lệ đơn hàng có khuyến mãi" → store_sales (ss)
- "trả hàng" (không rõ) → store_returns

=== VALUE MAPPINGS ===
QUỐC GIA (c_birth_country - UPPERCASE):
VN | JAPAN | UNITED STATES | UNITED KINGDOM | CA

GIỚI TÍNH (cd_gender): Nam=M | Nữ=F
HÔN NHÂN (cd_marital_status): Độc thân=S | Kết hôn=M | Ly hôn=D | Góa=W
TÍN DỤNG (cd_credit_rating): Low | Good | High Risk | Elite

=== COLUMN DISAMBIGUATION ===
"quốc tịch/đến từ" → c_birth_country (trong customer!)
"đang sống" → ca_country (trong customer_address)
"Tiến sĩ" danh xưng → c_salutation='Dr.' (trong customer!)
"năm sinh" → c_birth_year (dùng trực tiếp!)
"ưu tiên/thân thiết" → c_preferred_cust_flag (trong customer!)
"giảm giá" → ss_ext_discount_amt

=== CỘT KHÔNG TỒN TẠI (TUYỆT ĐỐI KHÔNG DÙNG!) ===
- c_birth_date_sk → dùng c_birth_year
- c_gender → dùng cd_gender (trong customer_demographics)
- cd_salutation → dùng c_salutation (trong customer)
- cd_preferred_cust_flag → dùng c_preferred_cust_flag (trong customer)
- ca_birth_country → dùng c_birth_country
- i_list_price → dùng i_current_price
- i_item_name → dùng i_product_name
- ss_order_number → dùng ss_ticket_number
- p_discount_amt → dùng ss_ext_discount_amt
- d_quarter → dùng d_qoy
- category table → dùng i.i_category

=== PROMOTION RATE PATTERN ===
CAST(SUM(CASE WHEN ss_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS FLOAT) / COUNT(*)
KHÔNG dùng AVG(boolean)
